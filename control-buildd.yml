# control-buildd.yml
---
- name: control wanna server
  hosts: buildd
  gather_facts: False
  vars:
    USAGE: |
      Usage:
      ansible-playbook ./control-buildd.yml [-l some hosts] -t usage
      ansible-playbook ./control-buildd.yml -t enable-buildd,debug
      ansible-playbook ./control-buildd.yml -t disable-buildd  -e ''
  tasks:
    - name: print Usage
      debug: var=USAGE.split('\n')
      tags: usage

    - name: enable-buildd
      shell: |
        rm -f ~buildd/EXIT-DAEMON-PLEASE
        rm -f ~buildd/NO-DAEMON-PLEASE
        kill -HUP `cat /var/run/crond.pid`
        sudo -u buildd buildd-watcher
      register: out
      tags:
        - enable-buildd

    - name: disable-buildd
      shell: |
        touch ~buildd/EXIT-DAEMON-PLEASE
        touch ~buildd/NO-DAEMON-PLEASE
      become: Ture
      become_user: buildd
      register: out
      tags:
        - disable-buildd

    - debug: var=out.stdout_lines
      tags: debug

    - debug: var=out
      tags: debugall

